<!DOCTYPE html>
<html lang="en-us">
    <head>
        <title>EPD Earth Signals Viewer</title>
        <meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link type="text/css" rel="stylesheet" href="styles.css">
        <link rel="shortcut icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    </head>

    <body>
        <!-- Hidden -->
        <audio id="audioStream" preload="none" crossorigin src=""></audio>

        <!-- Controls area -->
        <div id="controls">
            <!-- Source row -->
            <div id="controlsSource">
                <!-- feed select area -->
                <div>
                    [SOURCE]
                    <div class="tooltip">
                        <select id="sourceSelect">
                            <option value="stream">audio stream</option>
                            <option value="local">local file</option>
                        </select>
                        <span class="tooltiptext">Select web audio stream or local file.</span>
                    </div>

                    <!-- stream info (when selected) -->
                    <div id="feedStream" style="display:inline-block">
                        &nbsp;url
                        <input type="url" id="streamURL" value="" size="45" />
                    </div>

                    <!-- local file info (when selected) -->
                    <div id="feedFileLocal" style="display:none">
                        &nbsp;<input type="file" id="fileLocal" accept="audio/*" />
                    </div>
                </div>

                <!-- play controls -->
                <div>
                    <button class="mediaButton" type="button" id="playButton">&#x23F5;</button>
                    <button class="mediaButton" type="button" id="pauseButton" disabled>&#x23F8;</button>
                    <button class="mediaButton" type="button" id="stopButton" disabled>&#x23F9;</button>
                </div>

                <div>
                    <div class="tooltip">
                        [DISPLAY]
                        <span class="tooltiptext">Display options.</span>
                    </div>

                    <div class="tooltip">
                        <input type="text" id="displayFreqMin" value="" size="5" disabled />
                        <span class="tooltiptext">Minimum frequency to display. [option disabled for now]</span>
                    </div>
                    ..
                    <div class="tooltip">
                        <input type="text" id="displayFreqMax" value="" size="5" disabled />
                        <span class="tooltiptext">Maximum frequency to display. [option disabled for now]</span>
                    </div>&thinsp;Hz
                    <div class="divider">&#9483;</div>

                    <div class="tooltip">
                        <input type="text" id="minDb" value="" size=5 title="100 <= min < max" disabled />
                        <span class="tooltiptext">Minimum dB to display. Also used for color gradient. [option disabled for now]</span>
                    </div>
                    ..
                    <div class="tooltip">
                        <input type="text" id="maxDb" value="" size=5 title="min < max <= -10" disabled />&thinsp;dB
                        <span class="tooltiptext">Maximum dB to display. Also used for color gradient. [option disabled for now]</span>
                    </div>
                    <div class="divider">&#9483;</div>

                </div>

                <div class="tooltip">
                    cursor
                    <input type="text" value="" id="cursorInfo" readonly size="5" />&thinsp;Hz
                    <span class="tooltiptext">Moving cursor in spectrum window shows frequency band.</span>
                </div>

                <div class="tooltip">
                    gain
                    <input type="text" value="" id="gain" size="5" />
                    <span class="tooltiptext">Adjust signal gain by this ratio (unitless).</span>
                </div>

            </div>

            <!-- Parameters row -->
            <div id="controlsParams">
                <div>
                    <div class="tooltip">
                        [FFT]
                        <span class="tooltiptext">Fast Fourier Transform options.</span>
                    </div>
                    <div class="tooltip">
                        smoothing
                        <select id="smoothingSelect">
                            <option value="0.0">0.0 (none)</option>
                            <option value="0.1">0.1</option>
                            <option value="0.2">0.2</option>
                            <option value="0.3">0.3</option>
                            <option value="0.4">0.4</option>
                            <option value="0.5">0.5</option>
                            <option value="0.6">0.6</option>
                            <option value="0.7">0.7</option>
                            <option value="0.8">0.8</option>
                            <option value="0.9">0.9</option>
                            <option value="0.95">0.95</option>
                            <option value="0.99">0.99 (lots)</option>
                        </select>
                        <span class="tooltiptext">FFT cross-sample smoothing.</span>
                    </div>

                    <div class="tooltip">
                        &nbsp;bins
                        <select id="fftBinsSelect" disabled>
                            <option value="16">16</option>
                            <option value="32">32</option>
                            <option value="64">64</option>
                            <option value="128">128</option>
                            <option value="256">256</option>
                            <option value="512">512</option>
                            <option selected value="1024">1024</option>
                        </select>
                        <span class="tooltiptext">Number of FFT bins. [option disabled for now]</span>
                    </div>
                </div>

                <div>
                    <div class="tooltip">
                        [DENEM]
                        <span class="tooltiptext">"De-nem" filter options.  This is a frequency domain, adaptive, cross-sample sliding window filter.</span>
                    </div>
                    <div class="tooltip">
                        &nbsp;window
                        <input type="text" value="" id="denemWindow" size="4" />
                        <span class="tooltiptext">#FFT samples in sliding window.</span>
                    </div>
                    <div class="tooltip">
                        &nbsp;threshold
                        <input type="text" value="" id="denemThreshold" size="4" />&thinsp;dB
                        <span class="tooltiptext">Idenfify FFT bin as nem if this level above neighboring bins. Use large val (e.g. 100) to disable filter.</span>
                    </div>
                    <div class="tooltip">
                        &nbsp;bins
                        <input type="text" value="" id="denemBins" size="3" />
                        <span class="tooltiptext">Number of neighboring FFT bins in each direction to compare to for nem identification.</span>
                    </div>

                </div>

                <div>
                    <div class="tooltip">
                        [FILTER]
                        <span class="tooltiptext">Additional band pass/reject filter performed in frequency domain.</span>
                    </div>

                    <div class="tooltip">
                        <select id="filterType">
                            <option value="none">none</option>
                            <option value="bandPass">band pass</option>
                            <option value="bandReject" selected>band reject</option>
                        </select>
                        <span class="tooltiptext">Select filter type</span>
                    </div>

                    <div class="tooltip">
                        &nbsp;
                        <input type="text" value="" id="filterLow" size="6" />
                        <span class="tooltiptext">Low frequency of specified filter.</span>
                    </div>

                    <div class="tooltip">
                        ..
                        <input type="text" value="" id="filterHigh" size="6" />
                        <span class="tooltiptext">High frequency of specified filter.</span>
                    </div>&thinsp;Hz
                </div>


                <div>
                    <div class="tooltip">
                        [LOWER PANEL]
                        <span class="tooltiptext">Controls for the panel below the spectrum analyzer.</span>
                    </div>

                    <div class="tooltip">
                        <select id="lowerPanel">
                            <option value="waterfall" selected>waterfall</option>
                            <option value="metrics">chart recorder</option>
                        </select>
                        <span class="tooltiptext">Select what's displayed in lower panel: waterfall or chart recorder (full spectrum average amplitude over time).</span>
                    </div>

                    <div class="tooltip">
                        &nbsp;show
                        <select id="waterfallSmoothing">
                            <option value="0">sample</option>
                            <option value="1">smoothing</option>
                        </select>
                        <span class="tooltiptext">Show either per-sample or FFT smoothed in waterfall.</span>
                    </div>

                    <div id="crDiv" style="display:none">
                        &nbsp;speed
                        <div class="tooltip">
                            <select id="crSamplesPerTick">
                                <option value="1" selected>1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="30">30</option>
                                <option value="40">40</option>
                                <option value="50">50</option>
                            </select>
                            <span class="tooltiptext">Select number of spectrum samples per chart tick.  Will change horizontal speed.</span>
                        </div>

                        &nbsp;zone
                        <div class="tooltip">
                            <select id="crZone">
                                <option value="local" selected>local</option>
                                <option value="UTC">UTC</option>
                            </select>
                            <span class="tooltiptext">Select time zone for chart recorder timestamps.</span>
                        </div>

                    </div>
                </div>

            </div>
        </div>

        <canvas id="spectrum"  height="512" width="2076"></canvas>
        <canvas id="waterfall" height="512" width="2076"></canvas>
        <canvas id="metrics"   height="512" width="2076" style="display:none"></canvas>

        <script type="module" src="./fft_js/fft.js"></script>
        <script type="module" src="index.js"></script>
    </body>
</html>
